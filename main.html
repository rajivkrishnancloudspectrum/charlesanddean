<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Agentforce AI Portal</title>

  <style>
    body {
      margin:0;
      padding:0;
      height:100vh;
      width:100vw;
      overflow:hidden;
      font-family:-apple-system, sans-serif;
      background:#ffffff;
    }

    #landing-ui{
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      height:100vh;
    }

    #embeddedMessagingContainer{
      display:none;
      position:fixed;
      top:0; left:0;
      width:100vw;
      height:100vh;
      background:white;
      z-index:9999;
    }

    .searchBox{
      display:inline-flex;
      width:100%;
      max-width:700px;
      justify-content:center;
    }

    input{
      height:60px;
      font-size:20px;
      width:85%;
      padding:0 30px;
      border-radius:35px 0 0 35px;
      border:1px solid #d1d5db;
      outline:none;
    }

    button{
      width:80px;
      border:none;
      border-radius:0 35px 35px 0;
      font-size:24px;
      background:#ccc;
      color:white;
      cursor:not-allowed;
    }
  </style>
</head>

<body>

<div id="landing-ui">
  <h1 style="font-size:48px; font-weight:700; margin-bottom:20px;">
    How can <span style="color:#0070d2;">Agentforce</span> help?
  </h1>

  <div class="searchBox">
    <input id="agentInput" placeholder="Type your request..." />
    <button id="searchBtn" disabled>↑</button>
  </div>

  <p id="statusMsg" style="margin-top:15px; color:#666;">
    Initializing Agent…
  </p>
</div>

<div id="embeddedMessagingContainer"></div>

<script>
let capturedInput = "";
let chatLaunched = false;

function initEmbeddedMessaging() {

  embeddedservice_bootstrap.settings.language = "en_US";
  embeddedservice_bootstrap.settings.hideChatButtonOnLoad = true;

  // ESW Ready
  window.addEventListener("onEmbeddedMessagingReady", () => {
    const btn = document.getElementById("searchBtn");
    const msg = document.getElementById("statusMsg");

    btn.disabled = false;
    btn.style.background = "#202123";
    btn.style.cursor = "pointer";
    msg.innerText = "Agent is ready. Type your question.";
  });

  // Conversation opened → wait for iframe → THEN hide UI and send text
  window.addEventListener("onEmbeddedMessagingConversationOpened", () => {

    const waitForIframe = setInterval(() => {
      const frame = document.querySelector(".embeddedMessagingFrame");

      if (frame) {
        clearInterval(waitForIframe);

        document.getElementById("landing-ui").style.display = "none";
        document.getElementById("embeddedMessagingContainer").style.display = "block";

        if (capturedInput) {
          embeddedservice_bootstrap.utilAPI.sendTextMessage(capturedInput);
          capturedInput = "";
        }
      }
    }, 100);
  });

  embeddedservice_bootstrap.init(
    "00DTA00000B1e6j",
    "Web_AI_Agent",
    "https://charlesdean--partialcop.sandbox.my.site.com/ESWWebAIAgent1762338692563",
    {
      scrt2URL: "https://charlesdean--partialcop.sandbox.my.salesforce-scrt.com"
    }
  );
}

document.addEventListener("DOMContentLoaded", () => {

  const btn = document.getElementById("searchBtn");
  const input = document.getElementById("agentInput");

  input.addEventListener("input", () => {
    if(input.value.trim()){
      btn.disabled = false;
      btn.style.cursor = "pointer";
    } else {
      btn.disabled = true;
      btn.style.cursor = "not-allowed";
    }
  });

  const startChat = () => {
    if(chatLaunched) return;

    const text = input.value.trim();
    if(!text) return;

    capturedInput = text;
    input.value = "";
    chatLaunched = true;

    // Set inline mode ONLY now
    embeddedservice_bootstrap.settings.displayMode = "inline";
    embeddedservice_bootstrap.settings.targetElement =
      document.getElementById("embeddedMessagingContainer");

    embeddedservice_bootstrap.utilAPI.launchChat();
  };

  btn.addEventListener("click", startChat);
  input.addEventListener("keydown", e => {
    if(e.key === "Enter") startChat();
  });

});
</script>

<script
  src="https://charlesdean--partialcop.sandbox.my.site.com/ESWWebAIAgent1762338692563/assets/js/bootstrap.min.js"
  onload="initEmbeddedMessaging()">
</script>

<style>
.embeddedservice_bootstrap .embeddedMessagingFrame{
  position:fixed !important;
  top:0 !important;
  left:0 !important;
  width:100vw !important;
  height:100vh !important;
  border:none !important;
}
</style>

</body>
</html>
